# Polymarket BTC 5min 市场预测下注系统 — 产品需求文档 (PRD)

> **版本**: v1.0  
> **日期**: 2026-02-15  
> **状态**: 草案

---

## 一、项目概述

### 1.1 项目背景

Polymarket 提供基于 BTC 价格的 5 分钟预测市场（如"BTC 在接下来 5 分钟内是否会上涨？"），参与者可以对价格走势进行下注。本系统旨在构建一套**自动化/半自动化**的预测下注系统，通过量化策略在该市场中获取收益。

### 1.2 项目目标

| 目标 | 描述 |
|------|------|
| **数据驱动决策** | 整合多维行情数据，为预测策略提供高质量信号 |
| **策略可回测** | 任何策略上线前必须经过历史数据回测验证 |
| **自动化执行** | 策略信号触发后自动完成下单流程 |
| **风险可控** | 多层风控机制确保资金安全 |
| **可扩展性** | 架构支持快速接入新数据源、新策略、新市场 |

### 1.3 系统架构总览

```
┌─────────────────────────────────────────────────────────────────────┐
│                         Dashboard (Web UI)                         │
├──────────┬──────────┬──────────┬──────────┬──────────┬─────────────┤
│  行情监控  │ 订单簿面板 │  回测中心  │  交易面板  │  风控中心  │  系统监控    │
├──────────┴──────────┴──────────┴──────────┴──────────┴─────────────┤
│                        API Gateway / Event Bus                     │
├──────────┬──────────┬──────────┬──────────┬──────────┬─────────────┤
│ 行情引擎  │ 订单簿引擎 │  回测引擎  │  交易引擎  │  风控引擎  │  数据存储层   │
├──────────┴──────────┴──────────┴──────────┴──────────┴─────────────┤
│                     基础设施层 (日志/配置/监控/消息队列)               │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 二、模块一：行情监控系统 (Market Data Engine)

### 2.1 功能概述

实时采集、聚合、分析与 Polymarket BTC 5min 市场相关的多维数据，构建统一的行情视图。

### 2.2 数据源矩阵

| 数据源 | 类型 | 用途 | 频率 |
|--------|------|------|------|
| **Polymarket API** | 预测市场 | 市场价格、交易量、流动性 | 实时 WebSocket |
| **Binance / OKX / Coinbase** | 现货/合约 | BTC 现货价格、深度、资金费率 | 实时 WebSocket |
| **链上数据 (Polygon/Ethereum)** | 区块链 | Polymarket 合约事件、大额转账 | 区块级 (~2s) |
| **社交媒体 (Twitter/X)** | 舆情 | BTC 相关情绪指标 | 5s 轮询 |
| **宏观数据 (TradingView/FRED)** | 宏观经济 | 利率、CPI等宏观指标 | 事件驱动 |
| **Funding Rate** | 衍生品 | 各交易所资金费率 | 8h/实时 |

### 2.3 行情指标体系

#### 2.3.1 基础指标

| 指标名称 | 描述 | 计算周期 |
|----------|------|----------|
| `pm_price` | Polymarket YES token 当前价格 | tick |
| `pm_volume_5m` | Polymarket 5min 成交量 | 5min |
| `btc_price` | BTC 现货价格 (聚合多交易所) | tick |
| `btc_return_1m` | BTC 1分钟收益率 | 1min |
| `btc_return_5m` | BTC 5分钟收益率 | 5min |
| `spread` | PM YES价 vs 理论公允价差 | tick |

#### 2.3.2 技术指标 (可扩展)

| 指标名称 | 描述 | 参数 |
|----------|------|------|
| `SMA` | 简单移动平均 | period: [5, 10, 20, 60] |
| `EMA` | 指数移动平均 | period: [5, 10, 20, 60] |
| `RSI` | 相对强弱指标 | period: 14 |
| `MACD` | 指数平滑异同移动平均 | fast:12, slow:26, signal:9 |
| `Bollinger Bands` | 布林带 | period:20, std:2 |
| `ATR` | 平均真实波动幅度 | period:14 |
| `VWAP` | 成交量加权平均价 | session-based |
| `OBV` | 能量潮指标 | cumulative |
| `Momentum` | 动量指标 | period: [5, 10] |

#### 2.3.3 市场微观结构指标

| 指标名称 | 描述 |
|----------|------|
| `bid_ask_spread` | 买卖价差 |
| `order_imbalance` | 订单不平衡度 |
| `trade_flow_toxicity` | 交易流毒性 (VPIN) |
| `liquidity_score` | 流动性评分 |
| `price_impact` | 价格冲击系数 |

#### 2.3.4 情绪/链上指标

| 指标名称 | 描述 |
|----------|------|
| `fear_greed_index` | 恐贪指数 |
| `social_sentiment` | 社交媒体情绪评分 |
| `whale_movement` | 大户异动指标 |
| `open_interest_delta` | 未平仓合约变化 |
| `funding_rate_avg` | 综合资金费率 |

### 2.4 指标扩展框架

```python
# 指标插件接口 (示例)
class IndicatorPlugin(ABC):
    """所有自定义指标必须实现此接口"""
    
    @abstractmethod
    def name(self) -> str: ...
    
    @abstractmethod
    def required_fields(self) -> list[str]: ...
    
    @abstractmethod
    def calculate(self, data: DataFrame) -> Series: ...
    
    @abstractmethod
    def params(self) -> dict: ...
```

- 支持通过 **YAML 配置** 动态加载/卸载指标
- 支持指标依赖链自动解析
- 支持指标计算结果缓存

### 2.5 数据存储方案

| 数据类型 | 存储引擎 | 保留策略 |
|----------|----------|----------|
| Tick 数据 | TimescaleDB / InfluxDB | 90 天 (热) → 归档 (冷) |
| K线数据 | TimescaleDB | 永久 |
| 指标快照 | Redis (实时) + TimescaleDB (历史) | 实时: TTL 1h / 历史: 永久 |
| 事件数据 | PostgreSQL | 永久 |

### 2.6 非功能性需求

- 行情延迟 ≤ 100ms（从数据源到指标计算完成）
- 数据完整性校验（缺失/异常数据自动检测与修复）
- 数据源故障自动降级（主数据源故障 → 备用数据源）

---

## 三、模块二：预测订单簿系统 (Prediction Order Book Engine)

### 3.1 功能概述

实时追踪 Polymarket BTC 5min 市场的完整订单簿状态，提供深度分析与可视化。

### 3.2 核心数据采集

| 数据项 | 描述 | 采集方式 |
|--------|------|----------|
| **L2 Order Book** | 完整买卖挂单队列（价格+数量） | WebSocket 增量推送 |
| **Trade History** | 历史成交记录（价格+数量+方向+时间） | REST + WebSocket |
| **Market Info** | 市场元数据（开盘时间、结算规则、到期时间） | REST 定时轮询 |
| **CLOB Events** | Polymarket CLOB 协议事件 | WebSocket Stream |

### 3.3 订单簿分析功能

#### 3.3.1 深度分析

| 功能 | 描述 |
|------|------|
| **深度图** | 可视化买卖挂单分布 |
| **聚合深度** | 按价格区间聚合订单量 |
| **大单追踪** | 识别并追踪大额挂单（阈值可配置） |
| **撤单检测** | 监测大额挂单的挂撤行为（Spoofing detection） |
| **流动性热力图** | 时间 × 价格维度的流动性分布 |

#### 3.3.2 成交走势分析

| 功能 | 描述 |
|------|------|
| **成交量分布** | 按时间/价格的成交量分布统计 |
| **买卖力量对比** | 主动买 vs 主动卖的量价对比 |
| **成交节奏分析** | 成交频率、单笔均量变化趋势 |
| **大单成交监控** | 大额成交实时警报 |
| **市场结算统计** | 历史市场 YES/NO 结算结果统计 |

#### 3.3.3 订单流指标

| 指标 | 描述 |
|------|------|
| `CVD` | 累积成交量差值 (Cumulative Volume Delta) |
| `Order Flow Imbalance` | 订单流不平衡指标 |
| `Aggressor Ratio` | 主动成交占比 |
| `Book Pressure` | 买卖盘压力比 |
| `Sweep Detection` | 扫单行为检测 |

### 3.4 订单簿快照与回放

- 每 **1 秒** 存储一次订单簿快照（用于回测）
- 支持任意历史时刻的订单簿状态回放
- 快照压缩存储（增量编码 + LZ4 压缩）

---

## 四、模块三：回测引擎 (Backtesting Engine)

### 4.1 功能概述

提供高保真度的历史模拟环境，支持策略在历史数据上的验证与优化。

### 4.2 回测架构

```
┌─────────────┐     ┌──────────────┐     ┌──────────────┐
│  历史行情数据  │────→│   回测引擎    │────→│   绩效分析    │
├─────────────┤     ├──────────────┤     ├──────────────┤
│ 历史订单簿数据 │────→│  事件驱动模拟  │────→│  风险分析     │
├─────────────┤     ├──────────────┤     ├──────────────┤
│  策略代码     │────→│  虚拟交易撮合  │────→│  交易日志     │
└─────────────┘     └──────────────┘     └──────────────┘
```

### 4.3 回测模式

| 模式 | 描述 | 精度 | 速度 |
|------|------|------|------|
| **Candle-based** | 基于 K 线数据回测 | 中 | 快 |
| **Tick-based** | 基于逐笔数据回测 | 高 | 中 |
| **Order Book Replay** | 基于订单簿快照回放回测 | 最高 | 慢 |

### 4.4 策略接口

```python
class Strategy(ABC):
    """策略基类"""
    
    @abstractmethod
    def on_init(self, context: Context): 
        """策略初始化"""
        ...
    
    @abstractmethod
    def on_market_data(self, context: Context, data: MarketData):
        """行情更新回调"""
        ...
    
    @abstractmethod
    def on_order_book(self, context: Context, book: OrderBook):
        """订单簿更新回调"""
        ...
    
    @abstractmethod
    def on_trade(self, context: Context, trade: Trade):
        """成交回调"""
        ...
    
    @abstractmethod
    def on_order_update(self, context: Context, order: Order):
        """订单状态更新回调"""
        ...
    
    def on_timer(self, context: Context, timer_id: str):
        """定时器回调（可选）"""
        ...
```

### 4.5 虚拟交易撮合

| 特性 | 描述 |
|------|------|
| **滑点模拟** | 基于历史订单簿深度模拟真实滑点 |
| **手续费模拟** | 按 Polymarket 实际费率计算 |
| **流动性约束** | 订单不能超过历史深度可成交量 |
| **延迟模拟** | 可配置网络延迟（默认 50-200ms） |
| **部分成交** | 支持部分成交模拟 |

### 4.6 绩效分析报告

#### 4.6.1 核心指标

| 指标 | 描述 |
|------|------|
| `Total Return` | 总收益率 |
| `Annualized Return` | 年化收益率 |
| `Sharpe Ratio` | 夏普比率 |
| `Sortino Ratio` | 索提诺比率 |
| `Max Drawdown` | 最大回撤 |
| `Win Rate` | 胜率 |
| `Profit Factor` | 盈亏比 |
| `Avg Trade PnL` | 平均交易盈亏 |
| `Trade Count` | 交易次数 |
| `Calmar Ratio` | 卡马比率 |

#### 4.6.2 可视化报告

- 账户净值曲线
- 回撤曲线
- 每日/每周收益热力图
- 交易分布图（盈亏、持仓时长）
- 策略 vs 基准（Buy & Hold YES）对比
- 滚动夏普比率
- 蒙特卡洛模拟（置信区间）

### 4.7 参数优化

| 功能 | 描述 |
|------|------|
| **网格搜索** | 穷举参数组合 |
| **随机搜索** | 随机采样参数空间 |
| **贝叶斯优化** | 基于 Optuna 的智能参数搜索 |
| **Walk-Forward** | 滚动窗口前推优化（防过拟合） |
| **过拟合检测** | 样本内外表现对比、White's Reality Check |

---

## 五、模块四：交易执行引擎 (Trading Execution Engine)

### 5.1 功能概述

将策略信号转化为实际 Polymarket 订单，确保下单的准确性、及时性和可靠性。

### 5.2 交易流程

```
策略信号 → 风控预检 → 订单生成 → 订单签名 → 提交订单 → 状态追踪 → 结算确认
```

### 5.3 订单类型支持

| 订单类型 | 描述 | 适用场景 |
|----------|------|----------|
| **Market Order** | 市价单，立即成交 | 紧急信号、高确信度 |
| **Limit Order** | 限价单 | 常规建仓、精确入场 |
| **FOK** | Fill-or-Kill | 要求全部成交或取消 |
| **GTC** | Good-Till-Cancel | 持续挂单直到取消 |
| **GTD** | Good-Till-Date | 指定时间前有效 |

### 5.4 执行策略 (Execution Algorithm)

| 策略 | 描述 |
|------|------|
| **Immediate** | 直接提交订单 |
| **TWAP** | 时间加权分拆下单 |
| **Iceberg** | 冰山单（隐藏大单） |
| **Smart Router** | 根据实时深度智能选择订单类型和价格 |
| **Sniper** | 等待特定价位出现后快速成交 |

### 5.5 策略运行模式

| 模式 | 描述 | 风险 |
|------|------|------|
| **全自动** | 策略信号自动执行 | 高（需严格风控） |
| **半自动** | 策略信号需人工确认 | 中 |
| **纯手动** | 仅展示信号，手动操作 | 低 |
| **模拟盘** | Paper Trading，不实际下单 | 无 |

### 5.6 Polymarket 集成

| 功能 | 描述 |
|------|------|
| **钱包管理** | 安全管理签名密钥（支持 Hardware Wallet） |
| **CLOB API 集成** | 对接 Polymarket Central Limit Order Book |
| **USDC 余额管理** | 自动查询/充值 USDC 余额 |
| **Gas 优化** | 链上操作的 Gas 费用优化 |
| **Nonce 管理** | 防止交易重放和 Nonce 冲突 |

### 5.7 交易日志与审计

- 每笔订单完整生命周期记录
- 策略信号 → 实际执行的偏差分析
- 执行质量评估（滑点、延迟、成交率）
- 可导出 CSV/JSON 交易记录

---

## 六、模块五：风控系统 (Risk Management Engine)

### 6.1 功能概述

多层级、多维度的风险控制系统，覆盖交易前、中、后的全流程风险管理。

### 6.2 风控层级

```
┌─────────────────────────────────────┐
│         Layer 4: 熔断机制            │  ← 极端情况，全面停止
├─────────────────────────────────────┤
│         Layer 3: 账户级风控          │  ← 总资产、总敞口
├─────────────────────────────────────┤
│         Layer 2: 策略级风控          │  ← 单策略限制
├─────────────────────────────────────┤
│         Layer 1: 订单级风控          │  ← 单笔订单检查
└─────────────────────────────────────┘
```

### 6.3 风控规则详细定义

#### 6.3.1 Layer 1：订单级风控（交易前检查）

| 规则 ID | 规则名称 | 描述 | 默认阈值 |
|---------|---------|------|----------|
| R-101 | 单笔金额上限 | 单笔下注金额不超过阈值 | 100 USDC |
| R-102 | 价格合理性检查 | 订单价格偏离市场价超限则拒绝 | ±5% |
| R-103 | 频率限制 | 单位时间内下单次数限制 | 10 次/分钟 |
| R-104 | 最小收益率检查 | 预期收益率低于阈值不下单 | 2% |
| R-105 | 流动性检查 | 当前市场流动性不足则拒绝 | < $500 深度 |
| R-106 | 市场到期检查 | 距结算时间过近不下单 | < 30s |

#### 6.3.2 Layer 2：策略级风控

| 规则 ID | 规则名称 | 描述 | 默认阈值 |
|---------|---------|------|----------|
| R-201 | 策略日亏损限额 | 单策略单日最大亏损 | -200 USDC |
| R-202 | 策略连续亏损 | 连续亏损次数达限则暂停 | 5 次 |
| R-203 | 策略持仓上限 | 单策略最大持仓金额 | 500 USDC |
| R-204 | 策略回撤限制 | 策略净值回撤超限则暂停 | -10% |
| R-205 | 策略表现偏离 | 实盘表现显著偏离回测则告警 | 2σ |

#### 6.3.3 Layer 3：账户级风控

| 规则 ID | 规则名称 | 描述 | 默认阈值 |
|---------|---------|------|----------|
| R-301 | 总资产保护 | 账户总资产低于安全线 | < 初始 70% |
| R-302 | 日亏损总限额 | 所有策略合计日亏损上限 | -500 USDC |
| R-303 | 最大总敞口 | 所有未结算持仓总额上限 | 2000 USDC |
| R-304 | 集中度风险 | 单一市场占总资产比例上限 | 30% |

#### 6.3.4 Layer 4：熔断机制

| 规则 ID | 规则名称 | 描述 | 触发后动作 |
|---------|---------|------|------------|
| R-401 | 市场异常熔断 | BTC 价格 5min 波动超阈值 | 暂停所有交易 60s |
| R-402 | 系统故障熔断 | 数据源中断/延迟异常 | 暂停交易 + 告警 |
| R-403 | Polymarket 异常 | PM API 异常/市场暂停 | 立即停止 + 告警 |
| R-404 | 资金异常熔断 | 账户余额异常变动 | 紧急停止 + 撤单 |
| R-405 | 手动紧急停止 | 一键停止所有交易 | 撤销所有挂单 + 停止策略 |

### 6.4 预警与告警系统

#### 6.4.1 告警等级

| 等级 | 名称 | 描述 | 响应方式 |
|------|------|------|----------|
| **P0** | 🔴 紧急 | 资金安全受威胁 | 即时电话/短信 + 自动熔断 |
| **P1** | 🟠 严重 | 风控阈值已触发 | 即时通知 (Telegram/Discord) |
| **P2** | 🟡 警告 | 接近风控阈值 | 消息推送 |
| **P3** | 🔵 信息 | 常规运营事件 | 日志记录 |

#### 6.4.2 告警渠道

| 渠道 | 用途 | 延迟要求 |
|------|------|----------|
| **Telegram Bot** | 主要告警渠道 | < 3s |
| **Discord Webhook** | 团队协作通知 | < 5s |
| **Email** | 日报/周报/重要通知 | < 1min |
| **短信** | P0 级紧急告警 | < 10s |
| **Dashboard 弹窗** | 实时操作者通知 | 实时 |
| **声音告警** | 本地操作提醒 | 实时 |

### 6.5 安全控制

| 安全措施 | 描述 |
|----------|------|
| **API Key 加密存储** | 使用 Vault/KMS 管理敏感凭证 |
| **IP 白名单** | 限制交易 API 访问 IP |
| **2FA 认证** | 关键操作需二次认证 |
| **操作审计日志** | 所有配置变更和手动操作留痕 |
| **权限分级** | 操作员/管理员/只读 三级权限 |
| **私钥安全** | 签名密钥隔离存储，支持 HSM |

---

## 七、模块六：Dashboard 可视化面板 (新增)

### 7.1 功能概述

提供统一的 Web 可视化界面，整合所有模块数据，支持实时监控与操作。

### 7.2 页面规划

| 页面 | 核心内容 |
|------|----------|
| **总览** | 账户净值、当日 PnL、活跃策略数、风控状态一览 |
| **行情中心** | 多图表联动：BTC K线 + PM 市场价格 + 指标面板 |
| **订单簿** | 实时深度图、成交流、大单追踪 |
| **策略管理** | 策略列表、运行状态、实时 PnL |
| **回测中心** | 回测任务管理、报告查看、参数优化 |
| **交易记录** | 历史订单、成交明细、执行质量 |
| **风控面板** | 风控状态、告警历史、规则配置 |
| **系统设置** | 数据源配置、策略参数、风控阈值 |

### 7.3 技术选型建议

| 组件 | 推荐方案 |
|------|----------|
| 前端框架 | React + TypeScript |
| 图表库 | TradingView Lightweight Charts + ECharts |
| 状态管理 | Zustand |
| 实时通信 | WebSocket + Server-Sent Events |
| UI 组件 | Ant Design / Shadcn/ui |

---

## 八、模块七：策略管理与市场情报 (新增)

### 8.1 策略模板库

提供预置策略模板，降低策略开发门槛：

| 策略 | 类型 | 描述 |
|------|------|------|
| **Momentum** | 趋势 | 基于 BTC 价格动量预测 PM 市场方向 |
| **Mean Reversion** | 均值回归 | PM 价格偏离理论价值时反向下注 |
| **Order Flow** | 订单流 | 基于成交流和深度变化判断方向 |
| **Sentiment** | 情绪驱动 | 基于社交媒体情绪和恐贪指数 |
| **Arbitrage** | 套利 | PM YES + NO 价格偏离时套利 |
| **ML Ensemble** | 机器学习 | 多特征融合的 ML 预测模型 |
| **Hybrid** | 混合 | 多策略信号加权融合 |

### 8.2 策略竞赛 (Strategy Arena)

- 多策略并行 Paper Trading 对比
- 自动生成策略排行榜
- A/B 测试框架：新策略 vs 基线策略

### 8.3 市场情报模块

| 功能 | 描述 |
|------|------|
| **市场日历** | 重要经济事件、BTC 期权到期日 |
| **波动率预测** | 根据历史 + 隐含波动率预测未来波动 |
| **智能资金追踪** | 追踪 PM 市场大户的下注行为 |
| **市场异常检测** | 自动检测价格/量异常事件 |

---

## 九、模块八：系统监控与运维 (新增)

### 9.1 系统健康监控

| 监控项 | 描述 | 告警阈值 |
|--------|------|----------|
| API 延迟 | Polymarket API 响应时间 | > 500ms |
| WebSocket 连接 | WS 连接状态和断线重连 | 断线 > 3次/min |
| 数据源延迟 | 各数据源的数据延迟 | > 2s |
| CPU/内存 | 系统资源使用率 | > 80% |
| 磁盘空间 | 数据存储可用空间 | < 20% |
| 策略心跳 | 策略进程存活检查 | 超时 > 10s |

### 9.2 自动恢复机制

| 场景 | 恢复策略 |
|------|----------|
| WebSocket 断连 | 指数退避重连 (max 30s) |
| 数据源故障 | 自动切换备用数据源 |
| 策略进程崩溃 | 自动重启 + 状态恢复 |
| 数据库连接丢失 | 连接池自动重建 |

---

## 十、技术架构建议

### 10.1 技术栈推荐

| 层级 | 技术 | 理由 |
|------|------|------|
| **语言** | Python 3.11+ | 量化生态成熟、开发效率高 |
| **异步框架** | asyncio + aiohttp | 高并发 WebSocket 连接 |
| **消息队列** | Redis Streams / NATS | 低延迟事件分发 |
| **时序数据库** | TimescaleDB | 行情/指标存储 |
| **关系数据库** | PostgreSQL | 业务数据存储 |
| **缓存** | Redis | 实时数据缓存 |
| **任务调度** | Celery / APScheduler | 定时任务 |
| **容器化** | Docker + Docker Compose | 部署标准化 |
| **监控** | Prometheus + Grafana | 系统监控可视化 |
| **日志** | Loguru + ELK Stack | 日志采集分析 |

### 10.2 项目目录结构

```
polymarket-btc-predictor/
├── config/                    # 配置文件
│   ├── settings.yaml          # 全局配置
│   ├── strategies/            # 策略配置
│   ├── risk_rules.yaml        # 风控规则
│   └── indicators.yaml        # 指标配置
├── src/
│   ├── core/                  # 核心模块
│   │   ├── event_bus.py       # 事件总线
│   │   ├── context.py         # 上下文管理
│   │   └── plugin.py          # 插件框架
│   ├── market/                # 行情引擎
│   │   ├── datasources/       # 数据源适配器
│   │   ├── indicators/        # 指标计算
│   │   ├── aggregator.py      # 行情聚合器
│   │   └── storage.py         # 数据存储
│   ├── orderbook/             # 订单簿引擎
│   │   ├── book.py            # 订单簿管理
│   │   ├── analyzer.py        # 深度分析
│   │   ├── snapshot.py        # 快照管理
│   │   └── flow.py            # 订单流分析
│   ├── backtest/              # 回测引擎
│   │   ├── engine.py          # 回测核心
│   │   ├── matcher.py         # 虚拟撮合
│   │   ├── optimizer.py       # 参数优化
│   │   └── report.py          # 绩效报告
│   ├── trading/               # 交易引擎
│   │   ├── executor.py        # 订单执行器
│   │   ├── algorithms/        # 执行算法
│   │   ├── polymarket_api.py  # PM API 封装
│   │   └── wallet.py          # 钱包管理
│   ├── risk/                  # 风控引擎
│   │   ├── engine.py          # 风控核心
│   │   ├── rules/             # 风控规则
│   │   ├── circuit_breaker.py # 熔断器
│   │   └── alerting.py        # 告警系统
│   ├── strategy/              # 策略框架
│   │   ├── base.py            # 策略基类
│   │   ├── templates/         # 预置策略模板
│   │   └── arena.py           # 策略竞技
│   ├── dashboard/             # 前端 Dashboard
│   │   └── ...
│   └── utils/                 # 工具类
│       ├── logger.py
│       ├── crypto.py
│       └── time_utils.py
├── tests/                     # 测试
│   ├── unit/
│   ├── integration/
│   └── e2e/
├── scripts/                   # 运维脚本
├── docker/                    # Docker 配置
├── docs/                      # 文档
│   └── PRD.md
├── requirements.txt
├── pyproject.toml
└── README.md
```

---

## 十一、开发路线图

### Phase 1：基础设施 (Week 1-2)

- [x] 需求定义与方案设计
- [ ] 项目骨架搭建 (目录结构、配置框架、事件总线)
- [ ] 数据库 Schema 设计与初始化
- [ ] Polymarket API 集成 (REST + WebSocket)
- [ ] BTC 现货行情对接 (Binance WebSocket)

### Phase 2：行情 + 订单簿 (Week 3-4)

- [ ] 行情引擎 MVP (接入 PM + BTC 数据源)
- [ ] 基础技术指标实现 (SMA, EMA, RSI, MACD)
- [ ] 指标插件框架
- [ ] 订单簿引擎 (L2 深度采集与分析)
- [ ] 数据持久化与回放

### Phase 3：回测引擎 (Week 5-6)

- [ ] 回测引擎核心 (事件驱动框架)
- [ ] 虚拟撮合引擎
- [ ] 绩效分析模块
- [ ] 2-3 个策略模板实现
- [ ] 参数优化框架

### Phase 4：交易 + 风控 (Week 7-8)

- [ ] 交易执行引擎 (PM CLOB 下单)
- [ ] 钱包与签名管理
- [ ] 四层风控规则实现
- [ ] 告警系统对接 (Telegram + Discord)
- [ ] Paper Trading 模式

### Phase 5：Dashboard + 上线 (Week 9-10)

- [ ] Web Dashboard 开发
- [ ] 系统监控与自动恢复
- [ ] 集成测试与压力测试
- [ ] Paper Trading 验证 (至少运行 1 周)
- [ ] 正式上线 (小资金试跑)

### Phase 6：迭代优化 (持续)

- [ ] ML 策略模型接入
- [ ] 更多数据源集成
- [ ] 策略竞赛平台
- [ ] 性能优化
- [ ] 多市场拓展 (ETH 5min 等)

---

## 十二、风险与约束

### 12.1 已识别风险

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| Polymarket API 变更 | 高 | API 适配器模式，解耦业务逻辑 |
| 市场流动性不足 | 中 | 流动性检查 + 动态调整仓位 |
| 模型过拟合 | 高 | Walk-Forward + 样本外验证 |
| 网络延迟/中断 | 中 | 多节点部署 + 自动重连 |
| 监管政策变化 | 高 | 关注法规动态，预留合规接口 |
| 智能合约漏洞 | 高 | 限制单笔金额 + 审计 |

### 12.2 约束条件

- Polymarket 目前主要在 **Polygon 链**上运行，需考虑链上 Gas 和确认时间
- BTC 5min 市场的结算依赖 Polymarket 的预言机 (Oracle) 价格
- CLOB API 可能有频率限制 (Rate Limit)，需做好限流
- 需要足够的 USDC (Polygon) 余额作为下注资金

---

## 十三、成功指标 (KPI)

| 指标 | 目标值 | 衡量周期 |
|------|--------|----------|
| 系统可用性 | ≥ 99.5% | 月度 |
| 行情延迟 (E2E) | ≤ 200ms | 实时 |
| 策略胜率 | ≥ 55% | 周度 |
| 夏普比率 | ≥ 1.5 | 月度 |
| 最大回撤 | ≤ 15% | 月度 |
| 风控告警响应 | ≤ 5s | 实时 |
| Bug 修复时间 | P0 ≤ 2h, P1 ≤ 24h | 按需 |

---

## 附录

### A. 术语表

| 术语 | 定义 |
|------|------|
| PM | Polymarket |
| CLOB | Central Limit Order Book (中央限价订单簿) |
| YES/NO Token | PM 二元预测市场的代币 |
| CVD | Cumulative Volume Delta (累积成交量差值) |
| VPIN | Volume-Synchronized PIN (量同步概率知情交易) |
| Walk-Forward | 滚动窗口前推优化法 |

### B. 参考文档

- [Polymarket CLOB API 文档](https://docs.polymarket.com/)
- [Polymarket 合约地址 (Polygon)](https://polygonscan.com/)
- [py-clob-client (Python SDK)](https://github.com/Polymarket/py-clob-client)
- [Binance WebSocket API](https://binance-docs.github.io/apidocs/)

---

> **下一步**: 技术评审 → 确认技术方案 → 启动 Phase 1 开发
